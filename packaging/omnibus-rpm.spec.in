%define		rversion	@@RPMVER@@
%define		rrelease	1
%define		_prefix		/opt/circonus

Name:		nad-omnibus
Version:	%{rversion}
Release:	%{rrelease}%{?dist}
Summary:	A very thin, simply managed host agent written in Node.js
Prefix:		%{_prefix}
Group:		Applications/System
License:	BSD
Vendor:		Circonus, Inc.
URL:		https://github.com/circonus-labs/nad
BuildRoot:	%{_tmppath}/%{name}-%{rversion}-%{rrelease}

BuildRequires:	rsync
Conflicts:	circonus-field-nad, circonus-nodejs

%description
A very thin, simply managed host agent written in Node.js

%install
rm -rf $RPM_BUILD_ROOT
rsync -a /tmp/nad-omnibus-install/ $RPM_BUILD_ROOT/

%clean
rm -rf $RPM_BUILD_ROOT

%post
/sbin/chkconfig --add nad
/sbin/service nad restart >/dev/null 2>&1

%preun
if [ $1 = 0 ]; then
  /sbin/chkconfig --del nad
  /sbin/service nad stop >/dev/null 2>&1
fi

%files
/etc/init.d/nad
/etc/sysconfig/nad
%{_prefix}/embedded
%{_prefix}/man/man8/nad.8
%{_prefix}/etc/node-agent.d/disk.sh
%{_prefix}/etc/node-agent.d/haproxy/haproxy_backends.sh
%{_prefix}/etc/node-agent.d/freebsd/cpu.sh
%{_prefix}/etc/node-agent.d/illumos/vminfo.sh
%{_prefix}/etc/node-agent.d/illumos/zone_vfs.sh
%{_prefix}/etc/node-agent.d/illumos/sdinfo.sh
%{_prefix}/etc/node-agent.d/illumos/src/fs.c
%{_prefix}/etc/node-agent.d/illumos/src/aggcpu.c
%{_prefix}/etc/node-agent.d/illumos/src/cpu.c
%{_prefix}/etc/node-agent.d/illumos/src/zpoolio.c
%{_prefix}/etc/node-agent.d/illumos/src/Makefile
%{_prefix}/etc/node-agent.d/illumos/vnic.sh
%{_prefix}/etc/node-agent.d/illumos/udp.sh
%{_prefix}/etc/node-agent.d/illumos/cpu-1.sh
%{_prefix}/etc/node-agent.d/illumos/lib/kstat.lib
%{_prefix}/etc/node-agent.d/illumos/tcp.sh
%{_prefix}/etc/node-agent.d/illumos/io.js
%{_prefix}/etc/node-agent.d/illumos/Makefile
%{_prefix}/etc/node-agent.d/illumos/if.sh
%{_prefix}/etc/node-agent.d/illumos/smf.sh
%{_prefix}/etc/node-agent.d/illumos/zfsinfo.sh
%{_prefix}/etc/node-agent.d/linux/disk.sh
%{_prefix}/etc/node-agent.d/linux/cpu.sh
%{_prefix}/etc/node-agent.d/linux/src/fs.c
%{_prefix}/etc/node-agent.d/linux/src/Makefile
%{_prefix}/etc/node-agent.d/linux/systemd.sh
%{_prefix}/etc/node-agent.d/linux/Makefile
%{_prefix}/etc/node-agent.d/linux/if.sh
%{_prefix}/etc/node-agent.d/linux/fs.elf
%{_prefix}/etc/node-agent.d/linux/vm.sh
%{_prefix}/etc/node-agent.d/cpu.sh
%{_prefix}/etc/node-agent.d/postgresql/pg_replication.sh
%{_prefix}/etc/node-agent.d/common/loadavg.pl
%{_prefix}/etc/node-agent.d/common/process_memory.pl
%{_prefix}/etc/node-agent.d/common/ps.pl
%{_prefix}/etc/node-agent.d/common/boot_time.pl
%{_prefix}/etc/node-agent.d/common/file_md5sum.sh
%{_prefix}/etc/node-agent.d/common/file_stat.pl
%{_prefix}/etc/node-agent.d/common/file_cksum.sh
%{_prefix}/etc/node-agent.d/common/user_logins.pl
%{_prefix}/etc/node-agent.d/common/open_files.sh
%{_prefix}/etc/node-agent.d/common/net_listen.pl
%{_prefix}/etc/node-agent.d/smartos/jinf.sh
%{_prefix}/etc/node-agent.d/smartos/.index.json
%{_prefix}/etc/node-agent.d/if.sh
%{_prefix}/etc/node-agent.d/fs.elf
%{_prefix}/etc/node-agent.d/ohai/ohai.sh
%{_prefix}/etc/node-agent.d/ohai/find-ruby.sh
%{_prefix}/etc/node-agent.d/ohai/ohai2nad.rb
%{_prefix}/etc/node-agent.d/vm.sh
%{_prefix}/etc/node-agent.d/windows/wmi/wmi.json
%{_prefix}/etc/node-agent.d/windows/wmi/wmi.bat
%{_prefix}/etc/node-agent.d/windows/wmi/exec/wmi.js
%{_prefix}/etc/node-agent.d/windows/wmi/default.conf
%{_prefix}/lib/node_modules/dtrace_aggr/index.js
%{_prefix}/lib/node_modules/nad_circapi/index.js
%{_prefix}/lib/node_modules/circwmi/index.js
%{_prefix}/lib/node_modules/circonusapi2/index.js
%{_prefix}/lib/node_modules/thirty-two/README.md
%{_prefix}/lib/node_modules/thirty-two/index.js
%{_prefix}/lib/node_modules/thirty-two/package.json
%{_prefix}/lib/node_modules/thirty-two/spec/thirty-two_spec.js
%{_prefix}/lib/node_modules/thirty-two/LICENSE.txt
%{_prefix}/lib/node_modules/thirty-two/lib/thirty-two/index.js
%{_prefix}/lib/node_modules/thirty-two/lib/thirty-two/thirty-two.js
%{_prefix}/lib/node_modules/thirty-two/Makefile
%{_prefix}/sbin/nad

